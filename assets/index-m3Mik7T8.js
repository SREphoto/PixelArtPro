import{g as pt,a as xt}from"./index-DiViyoPl.js";const mt={},wt=Object.freeze(Object.defineProperty({__proto__:null,default:mt},Symbol.toStringTag,{value:"Module"})),at=pt(wt);var tt,ht;function gt(){if(ht)return tt;ht=1;var D=-1,p=12,T=5003,_=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];function Q(A,e,h,c){var t=Math.max(2,c),s=new Uint8Array(256),f=new Int32Array(T),q=new Int32Array(T),B,l=0,C,v=0,S,z=!1,L,I,F;function k(d,y){s[C++]=d,C>=254&&U(y)}function $(d){R(T),v=I+2,z=!0,O(I,d)}function R(d){for(var y=0;y<d;++y)f[y]=-1}function V(d,y){var M,X,N,G,Y,J,W;for(L=d,z=!1,n_bits=L,S=Z(n_bits),I=1<<d-1,F=I+1,v=I+2,C=0,G=x(),W=0,M=T;M<65536;M*=2)++W;W=8-W,J=T,R(J),O(I,y);t:for(;(X=x())!=D;){if(M=(X<<p)+G,N=X<<W^G,f[N]===M){G=q[N];continue}else if(f[N]>=0){Y=J-N,N===0&&(Y=1);do if((N-=Y)<0&&(N+=J),f[N]===M){G=q[N];continue t}while(f[N]>=0)}O(G,y),G=X,v<1<<p?(q[N]=v++,f[N]=M):$(y)}O(G,y),O(F,y)}function H(d){d.writeByte(t),remaining=A*e,curPixel=0,V(t+1,d),d.writeByte(0)}function U(d){C>0&&(d.writeByte(C),d.writeBytes(s,0,C),C=0)}function Z(d){return(1<<d)-1}function x(){if(remaining===0)return D;--remaining;var d=h[curPixel++];return d&255}function O(d,y){for(B&=_[l],l>0?B|=d<<l:B=d,l+=n_bits;l>=8;)k(B&255,y),B>>=8,l-=8;if((v>S||z)&&(z?(S=Z(n_bits=L),z=!1):(++n_bits,n_bits==p?S=1<<p:S=Z(n_bits))),d==F){for(;l>0;)k(B&255,y),B>>=8,l-=8;U(y)}}this.encode=H}return tt=Q,tt}var et,nt;function bt(){if(nt)return et;nt=1;var D=100,p=256,T=p-1,_=4,Q=16,A=1<<Q,e=10,h=10,c=A>>h,t=A<<e-h,s=p>>3,f=6,q=1<<f,B=s*q,l=30,C=10,v=1<<C,S=8,z=1<<S,L=C+S,I=1<<L,F=499,k=491,$=487,R=503,V=3*R;function H(U,Z){var x,O,d,y,M;function X(){x=[],O=new Int32Array(256),d=new Int32Array(p),y=new Int32Array(p),M=new Int32Array(p>>3);var r,i;for(r=0;r<p;r++)i=(r<<_+8)/p,x[r]=new Float64Array([i,i,i,0]),y[r]=A/p,d[r]=0}function N(){for(var r=0;r<p;r++)x[r][0]>>=_,x[r][1]>>=_,x[r][2]>>=_,x[r][3]=r}function G(r,i,m,a,u){x[i][0]-=r*(x[i][0]-m)/v,x[i][1]-=r*(x[i][1]-a)/v,x[i][2]-=r*(x[i][2]-u)/v}function Y(r,i,m,a,u){for(var n=Math.abs(i-r),w=Math.min(i+r,p),o=i+1,b=i-1,E=1,g,P;o<w||b>n;)P=M[E++],o<w&&(g=x[o++],g[0]-=P*(g[0]-m)/I,g[1]-=P*(g[1]-a)/I,g[2]-=P*(g[2]-u)/I),b>n&&(g=x[b--],g[0]-=P*(g[0]-m)/I,g[1]-=P*(g[1]-a)/I,g[2]-=P*(g[2]-u)/I)}function J(r,i,m){var a=2147483647,u=a,n=-1,w=n,o,b,E,g,P;for(o=0;o<p;o++)b=x[o],E=Math.abs(b[0]-r)+Math.abs(b[1]-i)+Math.abs(b[2]-m),E<a&&(a=E,n=o),g=E-(d[o]>>Q-_),g<u&&(u=g,w=o),P=y[o]>>h,y[o]-=P,d[o]+=P<<e;return y[n]+=c,d[n]-=t,w}function W(){var r,i,m,a,u,n,w=0,o=0;for(r=0;r<p;r++){for(m=x[r],u=r,n=m[1],i=r+1;i<p;i++)a=x[i],a[1]<n&&(u=i,n=a[1]);if(a=x[u],r!=u&&(i=a[0],a[0]=m[0],m[0]=i,i=a[1],a[1]=m[1],m[1]=i,i=a[2],a[2]=m[2],m[2]=i,i=a[3],a[3]=m[3],m[3]=i),n!=w){for(O[w]=o+r>>1,i=w+1;i<n;i++)O[i]=r;w=n,o=r}}for(O[w]=o+T>>1,i=w+1;i<256;i++)O[i]=T}function ut(r,i,m){for(var a,u,n,w=1e3,o=-1,b=O[i],E=b-1;b<p||E>=0;)b<p&&(u=x[b],n=u[1]-i,n>=w?b=p:(b++,n<0&&(n=-n),a=u[0]-r,a<0&&(a=-a),n+=a,n<w&&(a=u[2]-m,a<0&&(a=-a),n+=a,n<w&&(w=n,o=u[3])))),E>=0&&(u=x[E],n=i-u[1],n>=w?E=-1:(E--,n<0&&(n=-n),a=u[0]-r,a<0&&(a=-a),n+=a,n<w&&(a=u[2]-m,a<0&&(a=-a),n+=a,n<w&&(w=n,o=u[3]))));return o}function dt(){var r,i=U.length,m=30+(Z-1)/3,a=i/(3*Z),u=~~(a/D),n=v,w=B,o=w>>f;for(o<=1&&(o=0),r=0;r<o;r++)M[r]=n*((o*o-r*r)*z/(o*o));var b;i<V?(Z=1,b=3):i%F!==0?b=3*F:i%k!==0?b=3*k:i%$!==0?b=3*$:b=3*R;var E,g,P,j,K=0;for(r=0;r<a;)if(E=(U[K]&255)<<_,g=(U[K+1]&255)<<_,P=(U[K+2]&255)<<_,j=J(E,g,P),G(n,j,E,g,P),o!==0&&Y(o,j,E,g,P),K+=b,K>=i&&(K-=i),r++,u===0&&(u=1),r%u===0)for(n-=n/m,w-=w/l,o=w>>f,o<=1&&(o=0),j=0;j<o;j++)M[j]=n*((o*o-j*j)*z/(o*o))}function ct(){X(),dt(),N(),W()}this.buildColormap=ct;function vt(){for(var r=[],i=[],m=0;m<p;m++)i[x[m][3]]=m;for(var a=0,u=0;u<p;u++){var n=i[u];r[a++]=x[n][0],r[a++]=x[n][1],r[a++]=x[n][2]}return r}this.getColormap=vt,this.lookupRGB=ut}return et=H,et}var it,ot;function yt(){if(ot)return it;ot=1;const D=8;class p{constructor(){this.levels=Array.from({length:D},()=>[]),this.root=new T(0,this)}addColor(e){this.root.addColor(e,0,this)}makePalette(e){let h=[],c=0,t=this.leafNodes.length;for(let s=D-1;s>-1;s-=1)if(this.levels[s]){for(let f of this.levels[s])if(t-=f.removeLeaves(),t<=e)break;if(t<=e)break;this.levels[s]=[]}for(let s of this.leafNodes){if(c>=e)break;s.isLeaf&&h.push(s.color),s.paletteIndex=c,c++}return h}*makePaletteIncremental(e){let h=[],c=0,t=this.leafNodes.length;for(let s=D-1;s>-1;s-=1){if(this.levels[s]){for(let f of this.levels[s])if(t-=f.removeLeaves(),t<=e)break;if(t<=e)break;this.levels[s]=[]}yield}for(let s of this.leafNodes){if(c>=e)break;s.isLeaf&&h.push(s.color),s.paletteIndex=c,c++}return yield,h}get leafNodes(){return this.root.leafNodes}addLevelNode(e,h){this.levels[e].push(h)}getPaletteIndex(e){return this.root.getPaletteIndex(e,0)}}class T{constructor(e,h){this._color=new _(0,0,0),this.pixelCount=0,this.paletteIndex=0,this.children=[],this._debugColor,e<D-1&&h.addLevelNode(e,this)}get isLeaf(){return this.pixelCount>0}get leafNodes(){let e=[];for(let h of this.children)h&&(h.isLeaf?e.push(h):e.push(...h.leafNodes));return e}addColor(e,h,c){if(h>=D){this._color.add(e),this.pixelCount++;return}let t=Q(e,h);this.children[t]||(this.children[t]=new T(h,c)),this.children[t].addColor(e,h+1,c)}getPaletteIndex(e,h){if(this.isLeaf)return this.paletteIndex;let c=Q(e,h);if(this.children[c])return this.children[c].getPaletteIndex(e,h+1);for(let t of this.children)if(t)return t.getPaletteIndex(e,h+1)}removeLeaves(){let e=0;for(let h of this.children)h&&(this._color.add(h._color),this.pixelCount+=h.pixelCount,e++);return this.children=[],e-1}get debugColor(){if(this._debugColor)return this._debugColor;if(this.isLeaf)return this.color;let e=new _,h=0;function c(t){for(let s of t.children)s.isLeaf?(e.add(s._color),h++):c(s)}return c(this),e.normalized(h)}get color(){return this._color.normalized(this.pixelCount)}}class _{constructor(e=0,h=0,c=0){this.red=e,this.green=h,this.blue=c}clone(){return new _(this.red,this.green,this.blue)}get array(){return[this.red,this.green,this.blue,this.red+this.green+this.blue]}toString(){return[this.red,this.green,this.blue].join(",")}toCSS(){return`rgb(${[this.red,this.green,this.blue].map(e=>Math.floor(e)).join(",")})`}normalized(e){return new _(this.red/e,this.green/e,this.blue/e)}add(e){this.red+=e.red,this.green+=e.green,this.blue+=e.blue}}function Q(A,e){let h=0,c=128>>e;return A.red&c&&(h|=4),A.green&c&&(h|=2),A.blue&c&&(h|=1),h}return it={OctreeQuant:p,Node:T,Color:_},it}var rt,ft;function Bt(){if(ft)return rt;ft=1;const D=at,p=at,T=gt(),_=bt(),{OctreeQuant:Q,Color:A}=yt();class e{constructor(){this.data=[]}getData(){return Buffer.from(this.data)}writeByte(t){this.data.push(t)}writeUTFBytes(t){for(var s=t.length,f=0;f<s;f++)this.writeByte(t.charCodeAt(f))}writeBytes(t,s,f){for(var q=f||t.length,B=s||0;B<q;B++)this.writeByte(t[B])}}class h extends p{constructor(t,s,f="neuquant",q=!1,B=0){super(),this.width=~~t,this.height=~~s,this.algorithm=f,this.useOptimizer=q,this.totalFrames=B,this.frames=1,this.threshold=90,this.indexedPixels=null,this.palSizeNeu=7,this.palSizeOct=7,this.sample=10,this.colorTab=null,this.reuseTab=null,this.colorDepth=null,this.usedEntry=new Array,this.firstFrame=!0,this.started=!1,this.image=null,this.prevImage=null,this.dispose=-1,this.repeat=0,this.delay=0,this.transparent=null,this.transIndex=0,this.readStreams=[],this.out=new e}createReadStream(t){return t||(t=new D.Readable,t._read=function(){}),this.readStreams.push(t),t}emitData(){this.readStreams.length!==0&&this.out.data.length&&(this.readStreams.forEach(t=>{t.push(Buffer.from(this.out.data))}),this.out.data=[])}start(){this.out.writeUTFBytes("GIF89a"),this.started=!0,this.emitData()}end(){this.readStreams.length!==null&&(this.emitData(),this.readStreams.forEach(t=>t.push(null)),this.readStreams=[])}addFrame(t){t&&t.getImageData?this.image=t.getImageData(0,0,this.width,this.height).data:this.image=t,this.analyzePixels(),this.firstFrame&&(this.writeLSD(),this.writePalette(),this.repeat>=0&&this.writeNetscapeExt()),this.writeGraphicCtrlExt(),this.writeImageDesc(),this.firstFrame||this.writePalette(),this.writePixels(),this.firstFrame=!1,this.emitData(),this.totalFrames&&this.emit("progress",Math.floor(this.frames++/this.totalFrames*100))}analyzePixels(){const t=this.width,s=this.height;var f=this.image;if(this.useOptimizer&&this.prevImage){for(var q=0,B=f.length,l=0;l<B;l+=4)(f[l]!==this.prevImage[l]||f[l+1]!==this.prevImage[l+1]||f[l+2]!==this.prevImage[l+2])&&q++;const k=100-Math.ceil(q/(f.length/4)*100);this.reuseTab=k>=this.threshold}if(this.prevImage=f,this.algorithm==="neuquant"){var C=0;this.pixels=new Uint8Array(t*s*3);for(var l=0;l<s;l++)for(var v=0;v<t;v++){var S=l*t*4+v*4;this.pixels[C++]=f[S],this.pixels[C++]=f[S+1],this.pixels[C++]=f[S+2]}var z=this.pixels.length/3;this.indexedPixels=new Uint8Array(z),this.reuseTab||(this.quantizer=new _(this.pixels,this.sample),this.quantizer.buildColormap(),this.colorTab=this.quantizer.getColormap());for(var L=0,v=0;v<z;v++){var I=this.quantizer.lookupRGB(this.pixels[L++]&255,this.pixels[L++]&255,this.pixels[L++]&255);this.usedEntry[I]=!0,this.indexedPixels[v]=I}this.colorDepth=8,this.palSizeNeu=7,this.pixels=null}else if(this.algorithm==="octree"){this.colors=[],this.reuseTab||(this.quantizer=new Q);for(var l=0;l<s;l++)for(var v=0;v<t;v++){var S=l*t*4+v*4;const H=new A(f[S],f[S+1],f[S+2]);this.colors.push(H),this.reuseTab||this.quantizer.addColor(H)}const k=this.colors.length;if(this.indexedPixels=new Uint8Array(k),!this.reuseTab){this.colorTab=[];const $=this.quantizer.makePalette(Math.pow(2,this.palSizeOct+1));for(const R of $)this.colorTab.push(R.red,R.green,R.blue)}for(var l=0;l<k;l++)this.indexedPixels[l]=this.quantizer.getPaletteIndex(this.colors[l]);this.colorDepth=this.palSizeOct+1}if(this.transparent!==null){this.transIndex=this.findClosest(this.transparent);for(var F=0;F<z;F++)this.image[F*4+3]==0&&(this.indexedPixels[F]=this.transIndex)}}findClosest(t){if(this.colorTab===null)return-1;for(var s=(t&16711680)>>16,f=(t&65280)>>8,q=t&255,B=0,l=256*256*256,C=this.colorTab.length,v=0;v<C;){var S=v/3,z=s-(this.colorTab[v++]&255),L=f-(this.colorTab[v++]&255),I=q-(this.colorTab[v++]&255),F=z*z+L*L+I*I;this.usedEntry[S]&&F<l&&(l=F,B=S)}return B}setFrameRate(t){this.delay=Math.round(100/t)}setDelay(t){this.delay=Math.round(t/10)}setDispose(t){t>=0&&(this.dispose=t)}setRepeat(t){this.repeat=t}setTransparent(t){this.transparent=t}setQuality(t){t<1&&(t=1),this.quality=t}setThreshold(t){t>100?t=100:t<0&&(t=0),this.threshold=t}setPaletteSize(t){t>7?t=7:t<4&&(t=4),this.palSizeOct=t}writeLSD(){this.writeShort(this.width),this.writeShort(this.height),this.out.writeByte(240|this.palSizeNeu),this.out.writeByte(0),this.out.writeByte(0)}writeGraphicCtrlExt(){this.out.writeByte(33),this.out.writeByte(249),this.out.writeByte(4);var t,s;this.transparent===null?(t=0,s=0):(t=1,s=2),this.dispose>=0&&(s=this.dispose&7),s<<=2,this.out.writeByte(0|s|0|t),this.writeShort(this.delay),this.out.writeByte(this.transIndex),this.out.writeByte(0)}writeNetscapeExt(){this.out.writeByte(33),this.out.writeByte(255),this.out.writeByte(11),this.out.writeUTFBytes("NETSCAPE2.0"),this.out.writeByte(3),this.out.writeByte(1),this.writeShort(this.repeat),this.out.writeByte(0)}writeImageDesc(){this.out.writeByte(44),this.writeShort(0),this.writeShort(0),this.writeShort(this.width),this.writeShort(this.height),this.firstFrame?this.out.writeByte(0):this.out.writeByte(128|this.palSizeNeu)}writePalette(){this.out.writeBytes(this.colorTab);for(var t=3*256-this.colorTab.length,s=0;s<t;s++)this.out.writeByte(0)}writeShort(t){this.out.writeByte(t&255),this.out.writeByte(t>>8&255)}writePixels(){var t=new T(this.width,this.height,this.indexedPixels,this.colorDepth);t.encode(this.out)}finish(){this.out.writeByte(59),this.end()}}return rt=h,rt}var st,lt;function _t(){return lt||(lt=1,st=Bt()),st}var St=_t();const It=xt(St),Ct=Object.freeze(Object.defineProperty({__proto__:null,default:It},Symbol.toStringTag,{value:"Module"}));export{Ct as i};
